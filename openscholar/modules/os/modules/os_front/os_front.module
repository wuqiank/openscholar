<?php

include_once('os_front.features.inc');


function os_front_context_default_contexts_alter($contexts) {
  // add some extra blocks/boxes to the 'sitewide_front'
  if (isset($contexts['os_sitewide_front'])) {
    $b = &$contexts['os_sitewide_front']->reactions['block']['blocks'];

    $b['boxes-os_front_header'] = array(
      'module' => 'boxes',
      'delta' => 'os_front_header',
      'weight' => 0,
      'region' => 'header_second',
    );

    $b['boxes-os_front_create'] = array(
      'module' => 'boxes',
      'delta' => 'os_front_create',
      'weight' => 2,
      'region' => 'header_second',
    );

    $b['boxes-os_front_main_support'] = array(
      'module' => 'boxes',
      'delta' => 'os_front_main_support',
      'weight' => 0,
      'region' => 'content_first',
    );

    $b['boxes-os_front_main_configure'] = array(
      'module' => 'boxes',
      'delta' => 'os_front_main_configure',
      'weight' => 0,
      'region' => 'content_second',
    );

    $b['boxes-os_front_sample'] = array(
      'module' => 'boxes',
      'delta' => 'os_front_sample',
      'weight' => 0,
      'region' => 'footer',
    );

    $b['os_search_solr-site-search']['region'] = 'header_second';
    $b['os_search_solr-site-search']['weight'] = 1;
    $b['os_search_db-site-search']['region'] = 'header_second';
    $b['os_search_db-site-search']['weight'] = 1;
    $b['vsite_register-get_your_site_block']['region'] = false;
  }
}

function os_front_preprocess_html(&$vars) {
  if ($vars['is_front'] && !(module_exists('vsite') && vsite_get_vsite())) {
    $vars['classes_array'][] = 'sitewide-front';
  }
}

/**
 * Implements hook_theme().
 */
function os_front_theme() {
  return array(
    'os_front_boxcontent_sample' => array(
      'variables' => array('header' => NULL),
    ),
  );
}

/**
 * Theme function, returns an optional header and list of images.
 */
function theme_os_front_boxcontent_sample($variables) {
  $build = array();

  if (isset($variables['header'])) {
    $header = $variables['header'];
    $build['header'] = array(
      '#markup' => "<h2>{$header}</h2>",
    );
  }

  $images = $variables['images'];
  $items = array();
  foreach ($images as $image) {
    $items[] = array(
      'data' => theme('image', $image),
    );
  }
  $build['list'] = array(
    '#theme' => 'item_list',
    '#items' => $items,
  );

  $output = drupal_render($build);
  return $output;
}
